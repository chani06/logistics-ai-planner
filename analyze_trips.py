import pandas as pd
import io

data = '''Sep,BU,Code,WMS,Name,Tambon,Amphoe,Province,Route,Cube,Wgt,QTY,Trip,TripNo
1,PUNTHAI,NC48,NC48,‡∏ï‡∏•‡∏≤‡∏î‡∏Å‡∏µ‡∏¨‡∏≤‡∏Å‡∏•‡∏≤‡∏á,,,,,0.42,54.4,220,1,4W001
2,PUNTHAI,NC43,NC43,‡∏ñ‡∏ô‡∏ô‡∏®‡∏£‡∏µ‡∏ì‡∏£‡∏á‡∏Ñ‡πå,,,,,0.9,239.93,671,2,4W002
3,PUNTHAI,N987,N987,‡∏ñ‡∏ô‡∏ô‡∏°‡∏π‡∏•‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏™‡∏≤‡∏ó‡∏£,,,,,2.07,545.37,1727,3,4W003
4,Supply Use,PJ11002523,PJ11002523,‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏õ‡∏¥‡πÇ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢‡∏°,,,,,0.7,0,1,4,4W004
5,Supply Use,PJ11006053,PJ11006053,‡∏Æ‡∏±‡πà‡∏ß‡∏´‡∏•‡∏µ ‡∏õ‡∏¥‡πÇ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢‡∏°,,,,,0.7,0,1,5,4W005
6,PUNTHAI,NB46,NB46,‡∏ñ‡∏ô‡∏ô‡∏£‡∏≤‡∏ä‡∏°‡∏£‡∏£‡∏Ñ‡∏≤,,,,,0.42,52.95,164,6,4W006
7,PUNTHAI,11005993,11005993,FC ‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ò‡∏£,,,,,0.44,171.52,380,7,4W007
8,PUNTHAI,NC35,NC35,‡∏£‡∏û.‡πÄ‡∏ó‡∏û‡∏£‡∏±‡∏ï‡∏ô‡πå,,,,,0.58,209.21,447,8,4W008
9,MAX MART,N73,N73,‡∏™‡∏µ‡∏Ñ‡∏¥‡πâ‡∏ß7,,,,,55.82,28700.66,92240,9,6W001
10,MAX MART,MD73,MD73,‡∏®‡∏≤‡∏•‡∏≠‡∏≤‡∏ç‡∏≤‡∏£‡∏±‡∏ä‡∏î‡∏≤,‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πÄ‡∏Å‡∏©‡∏°,‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD1015,3.74,1241.88,4579,12,4WJ001
11,LUBE,SD73,SD73,‡∏®‡∏≤‡∏•‡∏≠‡∏≤‡∏ç‡∏≤‡∏£‡∏±‡∏ä‡∏î‡∏≤1,‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πÄ‡∏Å‡∏©‡∏°,‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD1015,0.22,115.9,153,12,4WJ001
13,PUNTHAI,11005218,11005218,FC ‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡πÄ‡∏î‡∏á,‡∏ï‡∏•‡∏≤‡∏î,‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏∞‡πÅ‡∏î‡∏á,‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£,CD1496,0.89,169.93,601,12,4WJ001
14,PUNTHAI,NZ03,NZ03,PTC ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏™‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå,‡∏ó‡∏∏‡πà‡∏á‡∏û‡∏ç‡∏≤‡πÑ‡∏ó,‡∏£‡∏≤‡∏ä‡πÄ‡∏ó‡∏ß‡∏µ,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD2261,0.15,23.74,65,12,4WJ001
15,PUNTHAI,N497,N497,‡∏ã‡∏±‡∏™‡πÇ‡∏Å‡πâ ‡∏û‡∏∏‡∏ó‡∏ò‡∏°‡∏ì‡∏ë‡∏•5,‡∏ö‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏∂‡∏Å,‡∏™‡∏≤‡∏°‡∏û‡∏£‡∏≤‡∏ô,‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°,CD3055,0.92,192.52,568,12,4WJ001
16,PUNTHAI,N243,N243,‡∏®‡∏≤‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏û‡∏ô‡πå 27,‡∏®‡∏≤‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏û‡∏ô‡πå,‡∏ó‡∏ß‡∏µ‡∏ß‡∏±‡∏í‡∏ô‡∏≤,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD5972,0.73,151.71,512,12,4WJ001
17,PUNTHAI,N268,N268,‡∏ã‡∏≠‡∏¢‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô,‡∏ó‡πâ‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£,‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£,CD2057,0.8,131.14,650,13,4WJ002
18,PUNTHAI,11004360,11004360,FC ‡∏û‡∏∏‡∏ó‡∏ò‡∏°‡∏ì‡∏ë‡∏•5,‡∏ö‡∏≤‡∏á‡πÄ‡∏ï‡∏¢,‡∏û‡∏∏‡∏ó‡∏ò‡∏°‡∏ì‡∏ë‡∏•,‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°,CD3242,0.47,113.87,322,13,4WJ002
19,MAX MART,MH64,MH64,‡∏ö‡∏£‡∏°‡∏£‡∏≤‡∏ä‡∏ä‡∏ô‡∏ô‡∏µ2,‡∏®‡∏≤‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏û‡∏ô‡πå,‡∏ó‡∏ß‡∏µ‡∏ß‡∏±‡∏í‡∏ô‡∏≤,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD5967,4.5,1466.43,5215,13,4WJ002
20,PUNTHAI,N063,N063,‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á 6,‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á,‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD6165,0.84,223.19,461,13,4WJ002
21,PUNTHAI,N645,N645,‡∏ñ.‡∏ó‡∏´‡∏≤‡∏£‡∏ö‡∏Å ‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°,‡∏ö‡πà‡∏≠‡∏û‡∏•‡∏±‡∏ö,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°,‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°,CD2989,0.9,163.92,507,14,4W009
22,MAX MART,M795,M795,‡∏ó‡∏ß‡∏µ‡∏ß‡∏±‡∏í‡∏ô‡∏≤2,‡∏®‡∏≤‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏û‡∏ô‡πå,‡∏ó‡∏ß‡∏µ‡∏ß‡∏±‡∏í‡∏ô‡∏≤,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD5977,3.03,983.48,3431,14,4W009
23,PUNTHAI,11004941,11004941,FC ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÑ‡∏ó‡∏¢‡∏†‡∏±‡∏ó‡∏£,‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á,‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD7209,0.59,142.83,388,14,4W009
27,PUNTHAI,PD99,PD99,‡∏û‡∏∏‡∏ó‡∏ò‡∏°‡∏ì‡∏ë‡∏•4,‡∏Å‡∏£‡∏∞‡∏ó‡∏∏‡πà‡∏°‡∏•‡πâ‡∏°,‡∏™‡∏≤‡∏°‡∏û‡∏£‡∏≤‡∏ô,‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°,CD31,1.26,248.41,810,22,4WJ004
28,PUNTHAI,N181,N181,‡∏ï‡∏•‡∏≤‡∏î‡∏ò‡∏±‡∏ô‡∏¢‡∏≤‡∏≠‡πâ‡∏≠‡∏°‡πÉ‡∏´‡∏ç‡πà,‡∏ó‡πà‡∏≤‡∏ï‡∏•‡∏≤‡∏î,‡∏™‡∏≤‡∏°‡∏û‡∏£‡∏≤‡∏ô,‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°,CD1931,1.1,244.29,739,22,4WJ004
29,PUNTHAI,N323,N323,‡∏ã‡∏≠‡∏¢‡∏ß‡∏±‡∏î‡∏™‡∏ß‡∏ô‡∏™‡πâ‡∏°,‡∏ö‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡∏á,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£,‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£,CD3369,0.46,96.3,325,22,4WJ004
30,LUBE,SE93,SE93,‡∏û‡∏∏‡∏ó‡∏ò‡∏°‡∏ì‡∏ë‡∏•‡∏™‡∏≤‡∏¢3,‡∏ö‡∏≤‡∏á‡πÑ‡∏ú‡πà,‡∏ö‡∏≤‡∏á‡πÅ‡∏Ñ,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD3372,0.59,303.6,47,22,4WJ004
31,PUNTHAI,11004609,11004609,FC T Park,‡∏ö‡∏≤‡∏á‡πÑ‡∏ú‡πà,‡∏ö‡∏≤‡∏á‡πÅ‡∏Ñ,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD3379,1,206.21,439,22,4WJ004
32,PUNTHAI,11004609,11004609,FC T Park2,‡∏ö‡∏≤‡∏á‡πÑ‡∏ú‡πà,‡∏ö‡∏≤‡∏á‡πÅ‡∏Ñ,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD3379,1,206.21,439,22,4WJ004
33,PUNTHAI,N934,N934,‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏°‡∏ï‡∏ï‡∏≤,‡∏®‡∏≤‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏û‡∏ô‡πå,‡∏ó‡∏ß‡∏µ‡∏ß‡∏±‡∏í‡∏ô‡∏≤,‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø,CD5983,0.67,151.26,693,22,4WJ004
175,PUNTHAI,N646,N646,‡∏û‡∏∏‡∏ó‡πÑ‡∏ò‡∏™‡∏á,‡∏û‡∏∏‡∏ó‡πÑ‡∏ò‡∏™‡∏á,‡∏û‡∏∏‡∏ó‡πÑ‡∏ò‡∏™‡∏á,‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå,CD4664,0.59,131.26,1271,24,4WJ022
176,PUNTHAI,PI86,PI86,‡πÇ‡∏ô‡∏ô‡πÅ‡∏î‡∏á5,‡∏ß‡∏±‡∏á‡∏´‡∏¥‡∏ô,‡πÇ‡∏ô‡∏ô‡πÅ‡∏î‡∏á,‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤,CD5735,2.89,589.16,2253,24,4WJ022
177,PUNTHAI,N150,N150,‡∏™‡∏µ‡∏î‡∏≤1,‡∏´‡∏ô‡∏≠‡∏á‡∏ï‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà,‡∏™‡∏µ‡∏î‡∏≤,‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤,CD6788,1.11,273.73,923,24,4WJ022
178,PUNTHAI,NY15,NY15,PTC ‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏ä‡∏¢‡∏û‡∏à‡∏ô‡πå,‡∏´‡∏ô‡∏≠‡∏á‡πÄ‡∏¢‡∏∑‡∏≠‡∏á,‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏ä‡∏¢‡∏û‡∏à‡∏ô‡πå,‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå,CD6979,1.47,345.27,1011,24,4WJ022
179,PUNTHAI,PD42,PD42,‡∏û‡∏¥‡∏°‡∏≤‡∏¢3,‡πÇ‡∏ö‡∏™‡∏ñ‡πå,‡∏û‡∏¥‡∏°‡∏≤‡∏¢,‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤,CD4122,0.28,94.71,253,24,4WJ022
262,PUNTHAI,P453,P453,‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó2,‡∏Å‡∏±‡∏á‡πÅ‡∏≠‡∏ô,‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó,‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå,CD69,2.36,536.05,1498,57,4WJ033
263,PUNTHAI,N954,N954,‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á ‡∏õ‡∏¥‡πÇ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢‡∏°,‡∏î‡∏≠‡∏á‡∏Å‡∏≥‡πÄ‡∏°‡πá‡∏î,‡∏Ç‡∏∏‡∏Ç‡∏±‡∏ô‡∏ò‡πå,‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,CD1336,0.89,195.19,542,57,4WJ033
264,PUNTHAI,PH22,PH22,‡∏™‡∏±‡∏á‡∏Ç‡∏∞2,‡∏™‡∏±‡∏á‡∏Ç‡∏∞,‡∏™‡∏±‡∏á‡∏Ç‡∏∞,‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå,CD6226,1.51,341.98,1033,57,4WJ033
265,PUNTHAI,PD71,PD71,‡∏Å‡∏±‡∏ô‡∏ó‡∏£‡∏•‡∏±‡∏Å‡∏©‡πå1,‡∏´‡∏ô‡∏≠‡∏á‡∏´‡∏ç‡πâ‡∏≤‡∏•‡∏≤‡∏î,‡∏Å‡∏±‡∏ô‡∏ó‡∏£‡∏•‡∏±‡∏Å‡∏©‡πå,‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,CD7055,0.92,123.03,212,57,4WJ033
266,PUNTHAI,N955,N955,PTF ‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á,‡πÇ‡∏ô‡∏ô‡∏Ñ‡πâ‡∏≠,‡πÇ‡∏ô‡∏ô‡∏Ñ‡∏π‡∏ì,‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,CD2736,0.06,8.5,23,57,4WJ033'''

df = pd.read_csv(io.StringIO(data))

print('='*80)
print('üîç ROUTE AND PROVINCE ANALYSIS - ‡∏´‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤')
print('='*80)

trips = df.groupby('TripNo')
issues = []

for trip_no, trip_data in trips:
    routes = trip_data['Route'].dropna().tolist()
    provinces = trip_data['Province'].dropna().unique()
    total_cube = trip_data['Cube'].sum()
    
    route_nums = []
    for r in routes:
        if pd.notna(r) and str(r) not in ['', 'nan']:
            try:
                num = int(str(r).replace('CD', ''))
                route_nums.append(num)
            except:
                pass
    
    route_range = max(route_nums) - min(route_nums) if len(route_nums) > 1 else 0
    
    # Check issues
    has_issue = route_range > 4000 or len(provinces) > 2
    
    if has_issue:
        issues.append({
            'trip': trip_no,
            'provinces': list(provinces),
            'route_range': route_range,
            'cube': total_cube,
            'data': trip_data
        })
        
        print(f'\nüö® Trip: {trip_no}')
        print(f'   ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ', end='')
        if route_range > 4000:
            print(f'Route ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ ({route_range}) ', end='')
        if len(provinces) > 2:
            print(f'‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ({len(provinces)})', end='')
        print()
        print(f'   ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: {list(provinces)}')
        print(f'   Route Range: {route_range}')
        print(f'   Cube ‡∏£‡∏ß‡∏°: {total_cube:.2f}')
        print(f'   ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≤‡∏Ç‡∏≤:')
        for _, row in trip_data.iterrows():
            code = row['Code']
            name = row['Name']
            prov = row['Province'] if pd.notna(row['Province']) else '-'
            route = row['Route'] if pd.notna(row['Route']) else '-'
            print(f'      - {code}: {name} | {prov} | {route}')

print(f'\n\n{"="*80}')
print(f'üìä ‡∏™‡∏£‡∏∏‡∏õ: ‡∏û‡∏ö {len(issues)} ‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤')
print('='*80)

# ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
print('\n\nüîÑ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:')
print('='*80)

for issue in issues:
    trip = issue['trip']
    provinces = issue['provinces']
    
    print(f'\nüìå Trip {trip}:')
    
    if len(provinces) > 2:
        # ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
        trip_data = issue['data']
        by_province = trip_data.groupby('Province')
        
        print('   ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:')
        for prov, prov_data in by_province:
            cube = prov_data['Cube'].sum()
            codes = prov_data['Code'].tolist()
            print(f'   - {prov}: {len(codes)} ‡∏™‡∏≤‡∏Ç‡∏≤, Cube={cube:.2f}')
            print(f'     ‡∏£‡∏´‡∏±‡∏™: {", ".join(codes)}')
