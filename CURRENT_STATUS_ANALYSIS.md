# ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 4 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2025

---

## üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

### 1. ‚úÖ **‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡∏™‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏Å‡∏•‡∏Å‡∏±‡∏ô** - ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1820-1840):**
```python
# üîí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤
if len(current_trip) >= 3:  # ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ‡∏°‡∏µ‡∏™‡∏≤‡∏Ç‡∏≤ >= 3
    code_lat, code_lon = coord_cache.get(code, (None, None))
    if code_lat:
        current_trip_distances = []
        for trip_code in current_trip:
            trip_lat, trip_lon = coord_cache.get(trip_code, (None, None))
            if trip_lat:
                dist = haversine_distance(code_lat, code_lon, trip_lat, trip_lon)
                current_trip_distances.append(dist)
        
        if current_trip_distances:
            avg_dist_current = sum(current_trip_distances) / len(current_trip_distances)
            max_dist_current = max(current_trip_distances)
            
            # üö® ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ > 25km ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏Å‡∏•‡∏™‡∏∏‡∏î > 40km ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°
            if avg_dist_current > 25 or max_dist_current > 40:
                continue
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ centroid

---

### 2. ‚úÖ **‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô** - ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1679-1720):**
```python
def find_closest_trip_for_branch(branch_code, all_trip_codes_dict, exclude_trip=None):
    \"\"\"
    ‡∏´‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤ - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ
    \"\"\"
    # üîí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ centroid)
    distances = []
    for code in codes:
        code_lat, code_lon = coord_cache.get(code, (None, None))
        if code_lat:
            dist = haversine_distance(branch_lat, branch_lon, code_lat, code_lon)
            distances.append(dist)
    
    avg_dist = sum(distances) / len(distances)
    max_dist = max(distances)
    
    # ‚ö° ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏Å‡∏•‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 40km
    if avg_dist < best_avg_dist and max_dist <= 40:
        best_avg_dist = avg_dist
        best_max_dist = max_dist
        best_trip = trip_num
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÇ‡∏î‡∏¢‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ

---

### 3. ‚ö†Ô∏è **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 4W/JB ‡πÅ‡∏ó‡∏ô 6W** - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢**

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2900-2920):**
```python
# üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏Å‡πà‡∏≠‡∏ô
if max_allowed == '4W':
    # ‡∏•‡∏≥‡∏î‡∏±‡∏ö 1: ‡∏•‡∏≠‡∏á 4W ‡∏Å‡πà‡∏≠‡∏ô (95-130%)
    if 95 <= cube_util_4w <= 130 and weight_util_4w <= 130:
        recommended = '4W'
elif max_allowed == 'JB':
    # ‡∏•‡∏≥‡∏î‡∏±‡∏ö 1: ‡∏•‡∏≠‡∏á 4W ‡∏Å‡πà‡∏≠‡∏ô (95-130%)
    if 95 <= cube_util_4w <= 130:
        recommended = '4W'
    # ‡∏•‡∏≥‡∏î‡∏±‡∏ö 2: ‡∏•‡∏≠‡∏á JB (95-130%)
    elif 95 <= cube_util_jb <= 130:
        recommended = 'JB'
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 4W ‚Üí JB ‚Üí 6W ‡πÅ‡∏•‡πâ‡∏ß

---

### 4. ‚ö†Ô∏è **‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å 2 ‡∏Ñ‡∏±‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ 75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô** - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Phase 2.5**

**‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å 2 ‡∏Ñ‡∏±‡∏ô:**
| ‡∏•‡∏≥‡∏î‡∏±‡∏ö | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | Cube ‡∏£‡∏ß‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î | ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô |
|-------|--------|----------------|----------------|
| 1 | JB + 4W | 13 cube | 75-95% |
| 2 | JB + JB | 16 cube | 75-95% |
| 3 | 6W + JB | 28 cube | 75-95% |
| 4 | 4W + 4W | 10 cube | 75-95% |

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**
```python
# ‡∏•‡∏≥‡∏î‡∏±‡∏ö 3: ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô JB + 4W ‡∏´‡∏£‡∏∑‡∏≠ JB + JB (75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô)
elif cube_util_jb > 130:
    # ‡∏•‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô JB + 4W (13 cube max)
    if total_c <= 13:
        recommended = 'JB+4W'
    else:
        recommended = 'JB+JB'  # 16 cube max
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚ö†Ô∏è **‡∏°‡∏µ logic ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ implement ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏à‡∏£‡∏¥‡∏á**

‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° **Phase 2.5** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏±‡∏ô:

```python
# üéØ Phase 2.5: ‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà Cube > 130% ‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏±‡∏ô (75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô)
split_2_vehicles_count = 0

for trip_num in test_df['Trip'].unique():
    trip_data = test_df[test_df['Trip'] == trip_num]
    trip_vehicle = trip_recommended_vehicles.get(trip_num, '4W')
    
    # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏ñ‡πâ‡∏≤ recommended ‡πÄ‡∏õ‡πá‡∏ô 'JB+4W', 'JB+JB', '4W+4W', '6W+JB')
    if '+' in trip_vehicle:
        vehicle_1, vehicle_2 = trip_vehicle.split('+')
        
        # ‡πÅ‡∏¢‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ Cube ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô (75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô)
        trip_data_sorted = trip_data.sort_values('Cube', ascending=False)
        codes = list(trip_data_sorted['Code'].values)
        
        g1_codes, g2_codes = [], []
        g1_cube, g2_cube = 0, 0
        
        target_cube_1 = LIMITS[vehicle_1]['max_c']
        target_cube_2 = LIMITS[vehicle_2]['max_c']
        
        for code in codes:
            branch_cube = trip_data_sorted[trip_data_sorted['Code'] == code]['Cube'].sum()
            
            # ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°
            g1_util = (g1_cube / target_cube_1) * 100
            g2_util = (g2_cube / target_cube_2) * 100
            
            if g1_util < g2_util and g1_util < 95:
                g1_codes.append(code)
                g1_cube += branch_cube
            elif g2_util < 95:
                g2_codes.append(code)
                g2_cube += branch_cube
            else:
                # ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ 95% ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                if abs(g1_util - 95) < abs(g2_util - 95):
                    g1_codes.append(code)
                    g1_cube += branch_cube
                else:
                    g2_codes.append(code)
                    g2_cube += branch_cube
        
        # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 75-95%
        g1_util_final = (g1_cube / target_cube_1) * 100
        g2_util_final = (g2_cube / target_cube_2) * 100
        
        if 75 <= g1_util_final <= 95 and 75 <= g2_util_final <= 95:
            # ‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ: ‡πÄ‡∏Å‡πá‡∏ö trip_num ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ g1, ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ g2
            new_trip_num = test_df['Trip'].max() + 1
            
            for code in g2_codes:
                test_df.loc[test_df['Code'] == code, 'Trip'] = new_trip_num
            
            # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ó‡∏£‡∏¥‡∏õ
            trip_recommended_vehicles[trip_num] = vehicle_1
            trip_recommended_vehicles[new_trip_num] = vehicle_2
            
            split_2_vehicles_count += 1
```

---

### 5. ‚úÖ **‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ 6W ‡πÉ‡∏ô‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û/‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏•** - ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2865-2870):**
```python
# ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô nearby ‚Üí ‡∏´‡πâ‡∏≤‡∏° 6W ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î!
if all_nearby:
    very_far = False  # ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ 6W
    if max_allowed == '6W':
        max_allowed = 'JB'  # ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÄ‡∏õ‡πá‡∏ô JB
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏´‡πâ‡∏≤‡∏° 6W ‡πÉ‡∏ô‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏•‡πÅ‡∏•‡πâ‡∏ß

---

### 6. ‚úÖ **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°** - ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2864):**
```python
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏Ç‡∏≤
max_allowed = get_max_vehicle_for_trip(trip_codes)
```

‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÉ‡∏ô **Phase 1.75** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2790-2828)

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**

---

### 7. ‚ö†Ô∏è **‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏° 95-130% ‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢** - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö Phase 1.5**

**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:**
- Cube 95-130% ‚Üí ‡∏û‡∏≠‡∏î‡∏µ ‚úÖ
- Cube < 95% ‚Üí ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤ ‚ö†Ô∏è
- Cube > 130% ‚Üí ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏±‡∏ô (75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô) ‚ö†Ô∏è

**‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°:**
```python
# üéØ Phase 1.5+: ‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà Cube < 95% ‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°
merge_low_util_count = 0

for trip_num in sorted(test_df['Trip'].unique()):
    trip_data = test_df[test_df['Trip'] == trip_num]
    total_c = trip_data['Cube'].sum()
    trip_vehicle = trip_recommended_vehicles.get(trip_num, '4W')
    
    # ‡∏ñ‡πâ‡∏≤ Cube < 95% ‚Üí ‡∏•‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô
    if '+' not in trip_vehicle:  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å 2 ‡∏Ñ‡∏±‡∏ô
        max_c = LIMITS[trip_vehicle]['max_c']
        cube_util = (total_c / max_c) * 100
        
        if cube_util < 95:
            # ‡∏´‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°
            best_merge_trip = None
            best_merge_dist = 9999
            
            for other_trip_num in test_df['Trip'].unique():
                if other_trip_num == trip_num or other_trip_num == 0:
                    continue
                
                other_data = test_df[test_df['Trip'] == other_trip_num]
                other_vehicle = trip_recommended_vehicles.get(other_trip_num, '4W')
                
                # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏£‡∏ñ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°
                if other_vehicle == trip_vehicle and '+' not in other_vehicle:
                    other_c = other_data['Cube'].sum()
                    other_util = (other_c / max_c) * 100
                    
                    # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 130%
                    combined_c = total_c + other_c
                    combined_util = (combined_c / max_c) * 100
                    
                    if 95 <= combined_util <= 130:
                        # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 2 ‡∏ó‡∏£‡∏¥‡∏õ
                        avg_dist = calculate_avg_distance_between_trips(
                            trip_data['Code'].values,
                            other_data['Code'].values,
                            coord_cache
                        )
                        
                        if avg_dist < best_merge_dist and avg_dist <= 30:
                            best_merge_dist = avg_dist
                            best_merge_trip = other_trip_num
            
            # ‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ
            if best_merge_trip:
                for code in trip_data['Code'].values:
                    test_df.loc[test_df['Code'] == code, 'Trip'] = best_merge_trip
                merge_low_util_count += 1
```

---

## üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞

| ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|-------------|-------|----------|
| 1. ‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡∏™‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏Å‡∏• | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß |
| 2. ‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î |
| 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 4W/JB ‡πÅ‡∏ó‡∏ô 6W | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | Logic ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß |
| 4. ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å 2 ‡∏Ñ‡∏±‡∏ô (75-95%) | ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Phase 2.5 |
| 5. ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ 6W ‡πÉ‡∏ô‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏• | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß |
| 6. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏Ç‡∏≤ | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡∏°‡∏µ Phase 1.75 ‡πÅ‡∏•‡πâ‡∏ß |
| 7. ‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏° 95-130% | ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö | ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ < 95% |

---

## üîß ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°

### 1. **Phase 2.5: ‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏±‡∏ô (75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô)**
- ‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà Cube > 130% ‡πÄ‡∏õ‡πá‡∏ô JB+4W, JB+JB, 4W+4W
- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏±‡∏ô‡πÑ‡∏î‡πâ 75-95%

### 2. **Phase 1.5+: ‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà Cube < 95%**
- ‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà Cube < 95% ‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°
- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ó‡∏∏‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡πÑ‡∏î‡πâ 95-130%

---

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**
- ‚úÖ ‡∏°‡∏µ logic ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ó‡∏£‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1820-1840)
- ‚úÖ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1679-1720)
- ‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 4W ‚Üí JB ‚Üí 6W ‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2900+)
- ‚úÖ ‡∏´‡πâ‡∏≤‡∏° 6W ‡πÉ‡∏ô‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏•‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2865-2870)

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°:**
1. Phase 2.5: ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏±‡∏ô (75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô)
2. Phase 1.5+: ‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà Cube < 95%

**‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 85%** - ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å/‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ 75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô
