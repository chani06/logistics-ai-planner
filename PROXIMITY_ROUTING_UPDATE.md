# ЁЯЪЫ р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Чр╕гр╕┤р╕Ы - Proximity Routing Update

## ЁЯУЛ р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕В

р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Чр╕гр╕┤р╕Ыр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╣Ар╕Юр╕╖р╣Ир╕нр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕кр╕│р╕Др╕▒р╕Н 4 р╕Ыр╕гр╕░р╣Ар╕Фр╣Зр╕Щ:

### тЬЕ р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕Вр╣Бр╕ер╣Йр╕з

1. **ЁЯМН Geographic Clustering** - р╣Др╕бр╣Ир╕Ир╕▒р╕Ър╕нр╕│р╣Ар╕ар╕нр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕Др╕Щр╕ер╕░р╕Чр╕┤р╕ир╕Чр╕▓р╕З (р╣Ар╕Кр╣Ир╕Щ р╣Бр╕бр╣Ир╕гр╕┤р╕б-р╣Ар╕лр╕Щр╕╖р╕н vs р╕ер╕│р╕Юр╕╣р╕Щ-р╣Гр╕Хр╣Й) р╣Ар╕Вр╣Йр╕▓р╕Чр╕гр╕┤р╕Ыр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
2. **ЁЯОп Priority Sorting** - р╕Ир╕▒р╕Фр╕кр╕▓р╕Вр╕▓ 4W р╣Гр╕лр╣Йр╣Ар╕Хр╣Зр╕бр╕Бр╣Ир╕нр╕Щ (р╣Ар╕Юр╕гр╕▓р╕░р╕бр╕╡р╕Вр╣Йр╕нр╕Ир╕│р╕Бр╕▒р╕Ф) р╣Бр╕ер╣Йр╕зр╕Др╣Ир╕нр╕вр╕Ир╕▒р╕Ф JB р╣Бр╕ер╕░ 6W
3. **ЁЯПЫя╕П Province Grouping** - р╕Ир╕▒р╕Фр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕Бр╕▒р╕Щр╕Бр╣Ир╕нр╕Щ р╣Др╕бр╣Ир╣Бр╕вр╕Бр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╕Ир╕Щр╕Бр╕зр╣Ир╕▓р╕Ир╕░р╕Др╕гр╕Ър╕Чр╕╕р╕Бр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Ф
4. **тЬФя╕П Minimum Standards** - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕бр╣Ир╣Гр╕лр╣Йр╕гр╕Цр╕бр╕╡ utilization р╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓р╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ (70%)

---

## ЁЯФз р╕Бр╕▓р╕гр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Бр╕Ыр╕ер╕Зр╣Ар╕Чр╕Др╕Щр╕┤р╕Д

### 1. р╣Ар╕Юр╕┤р╣Ир╕б Config р╣Гр╕лр╕бр╣И

```python
# ЁЯМН Geographic Clustering Config
MAX_DISTRICT_DISTANCE_KM = 50  # р╕нр╕│р╣Ар╕ар╕нр╕Чр╕╡р╣Ир╕лр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Ар╕Бр╕┤р╕Щ 50km р╣Др╕бр╣Ир╕Др╕зр╕гр╕нр╕вр╕╣р╣Ир╕Чр╕гр╕┤р╕Ыр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ (р╣Ар╕зр╣Йр╕Щр╣Бр╕Хр╣Ир╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ)
MIN_VEHICLE_UTILIZATION = 0.7  # р╕гр╕Цр╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 70% р╣Др╕бр╣Ир╣Гр╕лр╣Йр╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓р╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ
```

### 2. р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Гр╕лр╕бр╣Ир╕кр╕│р╕лр╕гр╕▒р╕Ъ Geographic Checking

#### `calculate_district_centroid(district_df)`
р╕Др╕│р╕Щр╕зр╕Ур╕Ир╕╕р╕Фр╕Бр╕ер╕▓р╕Зр╕Вр╕нр╕Зр╕нр╕│р╣Ар╕ар╕нр╕Ир╕▓р╕Бр╕Юр╕┤р╕Бр╕▒р╕Фр╕кр╕▓р╕Вр╕▓

```python
def calculate_district_centroid(district_df):
    """р╕Др╕│р╕Щр╕зр╕Ур╕Ир╕╕р╕Фр╕Бр╕ер╕▓р╕Зр╕Вр╕нр╕Зр╕нр╕│р╣Ар╕ар╕нр╕Ир╕▓р╕Бр╕Юр╕┤р╕Бр╕▒р╕Фр╕кр╕▓р╕Вр╕▓"""
    valid_coords = district_df[district_df['_lat'] > 0]
    if valid_coords.empty:
        return None, None
    return valid_coords['_lat'].mean(), valid_coords['_lon'].mean()
```

#### `check_geographic_proximity(district1_df, district2_df)`
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ 2 р╕нр╕│р╣Ар╕ар╕нр╣Гр╕Бр╕ер╣Йр╕Бр╕▒р╕Щр╕Юр╕нр╕Чр╕╡р╣Ир╕Ир╕░р╕нр╕вр╕╣р╣Ир╕Чр╕гр╕┤р╕Ыр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╣Др╕Фр╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И

**р╕Бр╕Ор╕Бр╕▓р╕гр╣Ар╕Кр╣Зр╕Др╕гр╕░р╕вр╕░р╕Чр╕▓р╕З**: 
- тЬЕ **р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ** тЖТ р╣Ар╕Кр╣Зр╕Др╕зр╣Ир╕▓р╕лр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ **80km** (threshold р╕Бр╕зр╣Йр╕▓р╕Зр╕Бр╕зр╣Ир╕▓)
  - р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕нр╕│р╣Ар╕ар╕нр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕Др╕Щр╕ер╕░р╕Фр╣Йр╕▓р╕Щр╕Вр╕нр╕Зр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╕Цр╕╣р╕Бр╕Ир╕▒р╕Ър╣Ар╕Вр╣Йр╕▓р╕Чр╕гр╕┤р╕Ыр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
  - р╣Ар╕Кр╣Ир╕Щ: р╕нр╕│р╣Ар╕ар╕нр╣Ар╕лр╕Щр╕╖р╕нр╕кр╕╕р╕Ф р╕Бр╕▒р╕Ъ р╕нр╕│р╣Ар╕ар╕нр╣Гр╕Хр╣Йр╕кр╕╕р╕Ф р╕Вр╕нр╕Зр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
- тЪая╕П **р╕Др╕Щр╕ер╕░р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Ф** тЖТ р╣Ар╕Кр╣Зр╕Др╕зр╣Ир╕▓р╕нр╕│р╣Ар╕ар╕нр╕лр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ **50km** (threshold р╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Ф)

```python
def check_geographic_proximity(district1_df, district2_df, max_distance_km=50):
    distance = haversine_distance(lat1, lon1, lat2, lon2)
    
    if prov1 == prov2:
        # р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ тЖТ threshold 80km
        return distance <= (max_distance_km * 1.6)
    else:
        # р╕Др╕Щр╕ер╕░р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Ф тЖТ threshold 50km
        return distance <= max_distance_km
```

### 3. р╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Зр╕ер╕│р╕Фр╕▒р╕Ър╣Гр╕лр╕бр╣И (Priority Sorting)

**р╣Ар╕Фр╕┤р╕б**: р╣Ар╕гр╕╡р╕вр╕Зр╕Хр╕▓р╕б Region тЖТ Province Max Dist тЖТ District Max Dist тЖТ Sum_Code
```python
# тЭМ р╣Бр╕Ър╕Ър╣Ар╕Бр╣Ир╕▓ (р╣Др╕бр╣Ир╕бр╕╡р╕ер╕│р╕Фр╕▒р╕Ър╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Н)
df.sort_values(['_region_order', '_prov_max_dist', '_dist_max_dist', '_sum_code'])
```

**р╣Гр╕лр╕бр╣И**: р╣Ар╕гр╕╡р╕вр╕Зр╕Хр╕▓р╕б Vehicle Priority тЖТ Region тЖТ Province (р╕Ир╕▒р╕Фр╕Бр╕ер╕╕р╣Ир╕б) тЖТ Sum_Code
```python
# тЬЕ р╣Бр╕Ър╕Ър╣Гр╕лр╕бр╣И (р╕Ир╕▒р╕Ф 4W р╕Бр╣Ир╕нр╕Щ)
vehicle_priority_map = {'4W': 1, 'JB': 2, '6W': 3}
df['_vehicle_priority'] = df['_max_vehicle'].map(vehicle_priority_map)

df.sort_values([
    '_vehicle_priority',  # ЁЯОп 4W р╕Бр╣Ир╕нр╕Щ (priority 1)
    '_region_order',      # р╣Ар╕гр╕╡р╕вр╕Зр╕Хр╕▓р╕бр╕ар╕▓р╕Д
    '_province',          # р╕Ир╕▒р╕Фр╕Бр╕ер╕╕р╣Ир╕бр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Ф
    '_sum_code',          # р╣Ар╕гр╕╡р╕вр╕Зр╕Хр╕▓р╕б sort code
    '_route',             # route р╕Чр╕╡р╣Ир╣Гр╕Бр╕ер╣Йр╕Бр╕▒р╕Щ
    '_distance_from_dc'   # р╕гр╕░р╕вр╕░р╕Чр╕▓р╕Зр╕Ир╕▓р╕Б DC
])
```

### 4. Province-First Grouping

**р╣Ар╕Фр╕┤р╕б**: Group by District р╣Вр╕Фр╕вр╕Хр╕гр╕З
```python
# тЭМ р╣Бр╕Ър╕Ър╣Ар╕Бр╣Ир╕▓
district_groups = df.groupby(['_region_name', '_province', '_district'])
for (region, province, district), district_df in district_groups:
    # р╕Ир╕▒р╕Фр╕Чр╕гр╕┤р╕Ы...
```

**р╣Гр╕лр╕бр╣И**: Group by Province р╕Бр╣Ир╕нр╕Щ р╣Бр╕ер╣Йр╕зр╕Ир╕╢р╕З iterate districts р╕ар╕▓р╕вр╣Гр╕Щ province
```python
# тЬЕ р╣Бр╕Ър╕Ър╣Гр╕лр╕бр╣И
province_groups = df.groupby(['_region_name', '_province'], sort=False)

# р╕кр╕гр╣Йр╕▓р╕З list р╕Вр╕нр╕З districts р╕Юр╕гр╣Йр╕нр╕б context р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Ф
district_groups = []
for (region, province), province_df in province_groups:
    for district, district_df in province_df.groupby('_district'):
        district_groups.append(((region, province, district), district_df))

# Track remaining branches per province
province_remaining = {}
for (region, province), province_df in province_groups:
    province_remaining[(region, province)] = len(province_df)
```

### 5. Provincial Completion Check

р╣Ар╕бр╕╖р╣Ир╕нр╕Юр╕┤р╕Ир╕▓р╕гр╕Ур╕▓р╕гр╕зр╕б district р╣Ар╕Вр╣Йр╕▓р╕Чр╕гр╕┤р╕Ы:

```python
# 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕вр╕▒р╕Зр╣Ар╕лр╕ер╕╖р╕нр╕кр╕▓р╕Вр╕▓р╣Гр╕Щр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Бр╣Ир╕▓р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
province_key = (region, current_province)
remaining = province_remaining.get(province_key, 0)

if remaining > 0:
    # тЭМ р╕вр╕▒р╕Зр╕бр╕╡р╕кр╕▓р╕Вр╕▓р╣Ар╕лр╕ер╕╖р╕н тЖТ р╣Др╕бр╣Ир╣Гр╕лр╣Йр╕Вр╣Йр╕▓р╕бр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Ф
    allow_merge = False
else:
    # тЬЕ р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Бр╣Ир╕▓р╕лр╕бр╕Фр╣Бр╕ер╣Йр╕з тЖТ р╣Ар╕Кр╣Зр╕Д proximity
    allow_merge = check_geographic_proximity(current_trip_df, district_df)
```

### 6. Minimum Utilization Check

р╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕ер╕╖р╕нр╕Бр╕Вр╕Щр╕▓р╕Фр╕гр╕Ц:

```python
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ utilization
current_util = max(weight_util, cube_util)
min_util_threshold = 70  # 70%

if current_util < min_util_threshold:
    # р╕ер╕нр╕Зр╣Гр╕Кр╣Йр╕гр╕Цр╣Ар╕ер╣Зр╕Бр╕Бр╕зр╣Ир╕▓
    if suggested == '6W' and 'JB' in allowed_vehicles:
        # р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ JB р╕Юр╕нр╕Фр╕╡р╣Др╕лр╕б
        if jb_util >= min_util_threshold:
            suggested = 'JB'
```

---

## ЁЯУК р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ

### р╕Бр╕гр╕Ур╕╡ 1: р╣Бр╕бр╣Ир╕гр╕┤р╕б vs р╕ер╕│р╕Юр╕╣р╕Щ (тЭМ р╣Др╕бр╣Ир╕Др╕зр╕гр╕нр╕вр╕╣р╣Ир╕Чр╕гр╕┤р╕Ыр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ)

**р╕Бр╣Ир╕нр╕Щр╣Бр╕Бр╣Йр╣Др╕В**:
```
Trip 1: р╣Бр╕бр╣Ир╕гр╕┤р╕б (р╣Ар╕лр╕Щр╕╖р╕н) + р╕ер╕│р╕Юр╕╣р╕Щ (р╣Гр╕Хр╣Й)  тЭМ 
тЖТ р╕Хр╣Йр╕нр╕Зр╕зр╕┤р╣Ир╕Зр╕Ьр╣Ир╕▓р╕Щр╕Хр╕▒р╕зр╣Ар╕бр╕╖р╕нр╕Зр╣Ар╕Кр╕╡р╕вр╕Зр╣Гр╕лр╕бр╣И р╣Др╕бр╣Ир╕кр╕бр╣Ар╕лр╕Хр╕╕р╕кр╕бр╕Ьр╕е
```

**р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Йр╣Др╕В**:
```
Trip 1: р╣Бр╕бр╣Ир╕гр╕┤р╕б + р╣Ар╕бр╕╖р╕нр╕Зр╣Ар╕Кр╕╡р╕вр╕Зр╣Гр╕лр╕бр╣И (р╕Чр╕┤р╕ир╣Ар╕лр╕Щр╕╖р╕н)  тЬЕ
Trip 2: р╕ер╕│р╕Юр╕╣р╕Щ + р╕Ыр╣Ир╕▓р╕Лр╕▓р╕З (р╕Чр╕┤р╕ир╣Гр╕Хр╣Й)  тЬЕ
тЖТ р╕Ир╕▒р╕Фр╕Хр╕▓р╕бр╕Чр╕┤р╕ир╕Чр╕▓р╕Зр╕ар╕╣р╕бр╕┤р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Чр╕╡р╣Ир╕кр╕бр╣Ар╕лр╕Хр╕╕р╕кр╕бр╕Ьр╕е
```

### р╕Бр╕гр╕Ур╕╡ 2: р╕Бр╕▓р╕гр╕Ир╕▒р╕Ф 4W Priority

**р╕Бр╣Ир╕нр╕Щр╣Бр╕Бр╣Йр╣Др╕В**:
```
Trip 1: JB - р╕кр╕▓р╕Вр╕▓ A, B, C, D (р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕Ир╕│р╕Бр╕▒р╕Ф)
Trip 2: 4W - р╕кр╕▓р╕Вр╕▓ E, F (р╕Ир╕│р╕Бр╕▒р╕Ф 4W)  тЭМ р╕гр╕Ц 4W р╕зр╣Ир╕▓р╕З
```

**р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Йр╣Др╕В**:
```
Trip 1: 4W - р╕кр╕▓р╕Вр╕▓ E, F, G, H, I (р╕Ир╕│р╕Бр╕▒р╕Ф 4W)  тЬЕ р╣Ар╕Хр╣Зр╕бр╕гр╕Цр╕Бр╣Ир╕нр╕Щ
Trip 2: JB - р╕кр╕▓р╕Вр╕▓ A, B, C, D
```

### р╕Бр╕гр╕Ур╕╡ 3: р╕Ир╕▒р╕Фр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╕Бр╣Ир╕нр╕Щ

**р╕Бр╣Ир╕нр╕Щр╣Бр╕Бр╣Йр╣Др╕В**:
```
Trip 1: р╣Ар╕Кр╕╡р╕вр╕Зр╣Гр╕лр╕бр╣И (3 р╕кр╕▓р╕Вр╕▓) + р╕ер╕│р╕Ыр╕▓р╕З (2 р╕кр╕▓р╕Вр╕▓)  тЭМ
Trip 2: р╣Ар╕Кр╕╡р╕вр╕Зр╣Гр╕лр╕бр╣И (р╣Ар╕лр╕ер╕╖р╕н 2 р╕кр╕▓р╕Вр╕▓)
```

**р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Йр╣Др╕В**:
```
Trip 1: р╣Ар╕Кр╕╡р╕вр╕Зр╣Гр╕лр╕бр╣И (5 р╕кр╕▓р╕Вр╕▓р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф)  тЬЕ р╕Ир╕Ър╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╣Ир╕нр╕Щ
Trip 2: р╕ер╕│р╕Ыр╕▓р╕З (2 р╕кр╕▓р╕Вр╕▓)
```

---

## ЁЯОп р╕Бр╕Ор╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Чр╕гр╕┤р╕Ыр╣Гр╕лр╕бр╣И (р╕кр╕гр╕╕р╕Ы)

### р╕ер╕│р╕Фр╕▒р╕Ър╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Н:

1. **ЁЯОп Vehicle Priority**: р╕Ир╕▒р╕Фр╕кр╕▓р╕Вр╕▓ 4W р╣Гр╕лр╣Йр╣Ар╕Хр╣Зр╕бр╕Бр╣Ир╕нр╕Щ тЖТ JB тЖТ 6W
2. **ЁЯПЫя╕П Province Completion**: р╕Ир╕▒р╕Фр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╣Гр╕лр╣Йр╕лр╕бр╕Фр╕Бр╣Ир╕нр╕Щ
3. **ЁЯМН Geographic Proximity**: р╣Др╕бр╣Ир╕Ир╕▒р╕Ър╕нр╕│р╣Ар╕ар╕нр╕Чр╕╡р╣Ир╕лр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Ар╕Бр╕┤р╕Щ 50km (р╣Ар╕зр╣Йр╕Щр╣Бр╕Хр╣Ир╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ)
4. **тЬФя╕П Minimum Utilization**: р╕гр╕Цр╕Хр╣Йр╕нр╕Зр╕бр╕╡ utilization тЙе 70%

### р╕Бр╕Ор╕гр╕░р╕вр╕░р╕Чр╕▓р╕З:

- тЬЕ **р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ**: р╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Гр╕лр╣Йр╕гр╕зр╕бр╕нр╕│р╣Ар╕ар╕нр╕Чр╕╡р╣Ир╕лр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ **80km**
  - р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕нр╕│р╣Ар╕ар╕нр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕Др╕Щр╕ер╕░р╕Фр╣Йр╕▓р╕Щр╕Вр╕нр╕Зр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╕Вр╕Щр╕▓р╕Фр╣Гр╕лр╕Нр╣Ир╕Цр╕╣р╕Бр╕Ир╕▒р╕Ър╕гр╕зр╕бр╕Бр╕▒р╕Щ
- тЪая╕П **р╕Др╕Щр╕ер╕░р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Ф**: р╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Гр╕лр╣Йр╕гр╕зр╕бр╕нр╕│р╣Ар╕ар╕нр╕Чр╕╡р╣Ир╕лр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ **50km** р╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ
- тЬЕ **Province р╕лр╕бр╕Фр╣Бр╕ер╣Йр╕з**: р╣Ар╕бр╕╖р╣Ир╕нр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╕Чр╕╕р╕Бр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Гр╕Щр╣Вр╕Лр╕Щр╣Ар╕лр╕ер╕╖р╕нр╣Бр╕Др╣Ир╣Ар╕ир╕й р╕Ир╕╢р╕Зр╕Др╣Ир╕нр╕вр╕гр╕зр╕бр╕Хр╕│р╕Ър╕е/р╕нр╕│р╣Ар╕ар╕нр╕Чр╕╡р╣Ир╣Гр╕Бр╕ер╣Йр╕Бр╕▒р╕Щ

---

## ЁЯзк р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕Фр╕кр╕нр╕Ъ:

1. р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣М Excel р╕Чр╕╡р╣Ир╕бр╕╡р╕кр╕▓р╕Вр╕▓р╣Гр╕Щр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╣Ар╕Кр╕╡р╕вр╕Зр╣Гр╕лр╕бр╣И (р╣Бр╕бр╣Ир╕гр╕┤р╕б, р╕ер╕│р╕Юр╕╣р╕Щ, р╕Ыр╣Ир╕▓р╕Лр╕▓р╕З)
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Чр╕гр╕┤р╕Ыр╣Др╕бр╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕гр╕зр╕б р╣Бр╕бр╣Ир╕гр╕┤р╕б + р╕ер╕│р╕Юр╕╣р╕Щ
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕кр╕▓р╕Вр╕▓ 4W р╕Цр╕╣р╕Бр╕Ир╕▒р╕Фр╕Бр╣Ир╕нр╕Щ JB/6W
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕гр╕Цр╣Др╕бр╣Ир╕бр╕╡ utilization р╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓ 70%

### р╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕кр╕▒р╕Зр╣Ар╕Бр╕Х:

- тЬЕ р╣Бр╕бр╣Ир╕гр╕┤р╕б (р╣Ар╕лр╕Щр╕╖р╕н) р╣Др╕бр╣Ир╕Др╕зр╕гр╕нр╕вр╕╣р╣Ир╕Бр╕▒р╕Ъ р╕ер╕│р╕Юр╕╣р╕Щ/р╕Ыр╣Ир╕▓р╕Лр╕▓р╕З (р╣Гр╕Хр╣Й)
- тЬЕ р╕кр╕▓р╕Вр╕▓ 4W р╕Хр╣Йр╕нр╕Зр╣Ар╕Хр╣Зр╕бр╕гр╕Цр╕Бр╣Ир╕нр╕Щ
- тЬЕ р╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╕Хр╣Йр╕нр╕Зр╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕Бр╕▒р╕Щ
- тЬЕ р╕гр╕Цр╕Чр╕╕р╕Бр╕Др╕▒р╕Щр╕Хр╣Йр╕нр╕З utilization тЙе 70%

---

## ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕р╕кр╕│р╕лр╕гр╕▒р╕Ъ Developer

### р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З Threshold:

```python
# р╣Гр╕Щ app.py (р╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Ыр╕гр╕░р╕бр╕▓р╕У 252-254)
MAX_DISTRICT_DISTANCE_KM = 50  # р╣Ар╕Юр╕┤р╣Ир╕б/р╕ер╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕гр╕▒р╕Ър╕Др╕зр╕▓р╕бр╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Ф
MIN_VEHICLE_UTILIZATION = 0.7  # р╣Ар╕Юр╕┤р╣Ир╕б/р╕ер╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕гр╕▒р╕Ър╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕гр╕Ц
```

### Debug Mode:

р╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╕зр╣Ир╕▓р╕гр╕░р╕Ър╕Ър╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╕нр╕вр╣Ир╕▓р╕Зр╣Др╕г р╣Ар╕Юр╕┤р╣Ир╕б print statements:

```python
# р╣Гр╕Щ check_geographic_proximity()
print(f"Check proximity: {prov1} vs {prov2} тЖТ distance: {distance:.1f}km")

# р╣Гр╕Щ Rule 1 р╕Вр╕нр╕З grouping loop
print(f"Allow merge: {allow_merge}, Province remaining: {remaining}")
```

---

## ЁЯФД Version History

- **v2.1** (24 Dec 2024): р╣Ар╕Юр╕┤р╣Ир╕б Geographic Clustering, Priority Sorting, Province Grouping, р╣Бр╕ер╕░ Minimum Standards Check
- **v2.0**: р╣Ар╕зр╕нр╕гр╣Мр╕Кр╕▒р╕Щр╕Бр╣Ир╕нр╕Щр╕лр╕Щр╣Йр╕▓ (р╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▓р╕гр╕Ир╕▒р╕Ф proximity)

---

## ЁЯСе р╕Ьр╕╣р╣Йр╕Юр╕▒р╕Тр╕Щр╕▓

- р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╣Вр╕Фр╕в: GitHub Copilot (Claude Sonnet 4.5)
- р╕зр╕▒р╕Щр╕Чр╕╡р╣И: 24 р╕Шр╕▒р╕Щр╕зр╕▓р╕Др╕б 2568

---

**р╕кр╕гр╕╕р╕Ы**: р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Чр╕гр╕┤р╕Ыр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╣Гр╕лр╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕▒р╕Ър╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕▓р╕Зр╕ар╕╣р╕бр╕┤р╕ир╕▓р╕кр╕Хр╕гр╣М р╕ер╕│р╕Фр╕▒р╕Ър╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Вр╕нр╕Зр╕гр╕Ц р╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕ер╕╕р╣Ир╕бр╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Фр╕нр╕вр╣Ир╕▓р╕Зр╕бр╕╡р╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Юр╕бр╕▓р╕Бр╕Вр╕╢р╣Йр╕Щ р╣Др╕бр╣Ир╕бр╕╡р╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣Ир╕Чр╕┤р╕ир╣Ар╕лр╕Щр╕╖р╕н-р╣Гр╕Хр╣Йр╕Цр╕╣р╕Бр╕Ир╕▒р╕Ър╣Ар╕Вр╣Йр╕▓р╕Чр╕гр╕┤р╕Ыр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╕нр╕╡р╕Бр╕Хр╣Ир╕нр╣Др╕Ы! тЬЕ
