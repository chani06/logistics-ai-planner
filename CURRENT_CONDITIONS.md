# üìã ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï 2024)

## üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å
**"‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡∏£‡∏≠‡∏õ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"**

---

## 1. ‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏£‡∏ñ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‚úÖ

```python
LIMITS = {
    '4W': {'max_w': 2500 kg, 'max_c': 5.0 m¬≥},
    'JB': {'max_w': 3500 kg, 'max_c': 7.0 m¬≥},
    '6W': {'max_w': 5500 kg, 'max_c': 20.0 m¬≥}
}

BUFFER = 1.05  # ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 5% (‡∏´‡∏£‡∏∑‡∏≠ 105%)
```

**‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
- Cube (m¬≥) ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‚Üí ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 5m¬≥ (4W) ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ JB
- Weight (kg) ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≠‡∏á ‚Üí ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 2500kg (4W) ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ JB
- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Utilization: **95-120%**

---

## 2. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤‡∏ï‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ ‚úÖ

```python
MAX_BRANCHES_PER_TRIP = 18  # ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 18 ‡∏™‡∏≤‡∏Ç‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 12)
TARGET_BRANCHES_PER_TRIP = 12  # ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 12 ‡∏™‡∏≤‡∏Ç‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 9)
```

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
- **‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡∏£‡∏≠‡∏õ** ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤‡∏ï‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 12 ‡∏™‡∏≤‡∏Ç‡∏≤/‡∏ó‡∏£‡∏¥‡∏õ (‡πÄ‡∏û‡∏¥‡πà‡∏° 33% ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°)
- ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 18 ‡∏™‡∏≤‡∏Ç‡∏≤/‡∏ó‡∏£‡∏¥‡∏õ (‡πÄ‡∏û‡∏¥‡πà‡∏° 50% ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°)

---

## 3. ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Utilization (‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ï‡πá‡∏°) ‚úÖ

```python
TARGET_UTIL = 100%   # ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 95%)
MAX_PICKUP_UTIL = 130%  # ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 125%)
```

**Phase 1.5 - Route Pickup:**
- ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏ô‡πÄ‡∏ï‡πá‡∏° 100% (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà 95%)
- ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏ñ‡∏∂‡∏á 130% (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà 125%)

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏∂‡πâ‡∏ô 5-10%
- ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°

---

## 4. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‚úÖ

### 4.1 ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ
```python
all_trips.sort(key=lambda x: (
    x['primary_province'],  # 1. ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô
    x['distance_from_dc'],  # 2. ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡πÉ‡∏Å‡∏•‡πâ ‚Üí ‡πÑ‡∏Å‡∏•)
    x['count'],             # 3. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤ (‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏°‡∏≤‡∏Å)
    x['util']               # 4. Utilization (‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏°‡∏≤‡∏Å)
))
```

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:**
- **‡∏à‡∏±‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô** ‚Üí ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
- **‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡πà‡∏≠‡∏ô** ‚Üí ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
- **‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏•‡πá‡∏Å‡∏Å‡πà‡∏≠‡∏ô** ‚Üí ‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏´‡∏ç‡πà

---

### 4.2 ‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡∏Ç‡πâ‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‚úÖ

```python
# ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
if same_province:
    can_merge = True  ‚úÖ

# ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
else:
    if centroid_distance <= 60 km:  # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 40km
        can_merge = True  ‚úÖ
    else:
        can_merge = False  ‚ùå
```

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
- ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‚Üí ‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
- ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô (<60km) ‚Üí ‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 40km)
- ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡πÑ‡∏Å‡∏•‡∏Å‡∏±‡∏ô (>60km) ‚Üí ‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°

---

## 5. ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£ Merge (Phase 1) ‚úÖ

‡∏°‡∏µ **6 ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç** ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 1: ‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏•‡πá‡∏Å (‚â§3 ‡∏™‡∏≤‡∏Ç‡∏≤)
```python
if trip1['count'] <= 3 or trip2['count'] <= 3:
    if combined_util <= 130%:
        merge = True  # ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô buffer ‡∏ñ‡πâ‡∏≤‡πÅ‡∏¢‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°
    elif combined_util <= 110%:
        merge = True  # ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 10%
```

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 2: ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 50%
```python
elif trip1['util'] < 50% and trip2['util'] < 50%:
    if 60% <= combined_util <= 130%:
        merge = True
```

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 2.5: ‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 30%
```python
elif trip1['util'] < 30% or trip2['util'] < 30%:
    if combined_util <= 115%:
        merge = True
```

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 3: ‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡∏£‡∏ñ 80-105%
```python
elif 80% <= combined_util <= 105%:
    if combined_count <= 13:
        merge = True
```

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 4: ‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡∏™‡∏≤‡∏Ç‡∏≤ ‚â§10 ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡∏ñ 70-105%
```python
elif combined_count <= 10 and 70% <= combined_util <= 105%:
    merge = True
```

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 5: ‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å (‚â§3 ‡∏™‡∏≤‡∏Ç‡∏≤) ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô
```python
elif trip1['count'] <= 3 or trip2['count'] <= 3:
    if combined_util <= 115%:
        merge = True
```

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 6: ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‚úÖ üÜï
```python
elif same_province and combined_count <= MAX_BRANCHES:
    if 50% <= combined_util <= 110%:
        merge = True  # ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
    elif trip1['util'] < 60% and trip2['util'] < 60%:
        if combined_util <= 115%:
            merge = True  # ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡∏ï‡πà‡∏≥ ‚Üí ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô
```

---

## 6. ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ‡∏ï‡∏≤‡∏°‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ (Phase 2) ‚úÖ

### 6.1 ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ
```python
NEARBY = [
    '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£', '‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ', '‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ', 
    '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£', '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£', '‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°'
]

CENTRAL = [
    '‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤', '‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ', '‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ', 
    '‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó', '‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ', '‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á'
]

FAR = ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
```

### 6.2 ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ

#### 1Ô∏è‚É£ ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å (>200km)
```python
if max_distance_from_dc > 200 km:
    recommended = '6W'  # ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ 6W
```

#### 2Ô∏è‚É£ ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û + ‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏• (NEARBY)
```python
if all_nearby:
    if cube_util_4w <= 120%:
        recommended = '4W'  # ‡∏•‡∏≠‡∏á 4W ‡∏Å‡πà‡∏≠‡∏ô
    elif cube_util_jb <= 130%:
        recommended = 'JB'  # ‡πÑ‡∏°‡πà‡∏û‡∏≠ ‚Üí JB
    else:
        recommended = 'JB'  # ‡πÄ‡∏Å‡∏¥‡∏ô JB ‚Üí ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ JB
        ‚ö†Ô∏è WARNING: ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏¥‡∏ô JB ‡πÅ‡∏ï‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ JB (‡∏´‡πâ‡∏≤‡∏° 6W)
```

#### 3Ô∏è‚É£ ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏Å‡∏• (FAR)
```python
else:
    recommended = '6W'  # ‡πÉ‡∏ä‡πâ 6W ‡πÄ‡∏ï‡πá‡∏°‡∏Å‡πà‡∏≠‡∏ô
```

**‡∏™‡∏£‡∏∏‡∏õ:**
- **‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û/‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏•: ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ 6W ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î** ‚ùå
- **‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏Å‡∏•: ‡πÉ‡∏ä‡πâ 6W ‡πÄ‡∏ï‡πá‡∏°‡∏Å‡πà‡∏≠‡∏ô** ‚úÖ
- **‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å (>200km): ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö 6W** ‚úÖ

---

## 7. ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏Ç‡∏≤ (Branch Restrictions) ‚úÖ

### 7.1 ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (3-Tier Priority)
```
1. Booking History (2,790 ‡∏™‡∏≤‡∏Ç‡∏≤) - PRIMARY
2. Punthai Reference (406 ‡∏™‡∏≤‡∏Ç‡∏≤) - SECONDARY  
3. Master Data (7,629 ‡∏™‡∏≤‡∏Ç‡∏≤) - TERTIARY
```

### 7.2 ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ
```python
# Phase 2.1: Force Check
max_allowed = get_max_vehicle_for_trip(trip_codes)

if current_vehicle > max_allowed:
    # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏ä‡πâ 6W ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≥‡∏Å‡∏±‡∏î 4W
    
    if can_fit_in_allowed_vehicle:
        # ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 4W/JB
        recommended = max_allowed  ‚úÖ
    else:
        # ‡πÅ‡∏¢‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏´‡∏°‡πà
        split_restricted_branches()  ‚úÖ
```

---

## 8. ‡∏•‡∏≥‡∏î‡∏±‡∏ö Phase ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (8 Phase)

### Phase 1: Merge Trips
- ‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏•‡πá‡∏Å (‚â§3 ‡∏™‡∏≤‡∏Ç‡∏≤) ‡πÅ‡∏•‡∏∞‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
- 6 ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
- ‡∏à‡∏≥‡∏Å‡∏±‡∏î 50 ‡∏£‡∏≠‡∏ö (MAX_MERGE_ITERATIONS)

### Phase 1.25: Reassign Single Branches
- ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (util <40%) ‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏´‡∏ç‡πà
- ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á <50km (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 30km)
- ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ util ‡∏ñ‡∏∂‡∏á 125%

### Phase 1.5: Route Pickup
- ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤ unassigned ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: 100% util (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 95%)
- ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: 130% util (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 125%)

### Phase 1.75: Rebalance Low Utilization üÜï
- ‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ util <50% ‡πÅ‡∏•‡∏∞ ‚â§6 ‡∏™‡∏≤‡∏Ç‡∏≤
- ‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á (<50km)
- ‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß ‚â§120%

### Phase 2: Optimize Vehicle Selection
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ‡∏ï‡∏≤‡∏°‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ
- Bangkok: 4W ‚Üí JB (‡∏´‡πâ‡∏≤‡∏° 6W)
- Far: 6W first
- Very Far (>200km): 6W mandatory

### Phase 2.1: Force Check Restrictions
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏Ç‡∏≤
- ‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î

### Phase 2.5: Split Overloaded Trips
- ‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ Cube >120%
- ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡πÅ‡∏¢‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ó‡∏£‡∏¥‡∏õ ‚â•100%

### Phase 3: Split Underutilized 6W
- ‡πÅ‡∏¢‡∏Å 6W <65% util ‡πÅ‡∏•‡∏∞ ‚â•6 ‡∏™‡∏≤‡∏Ç‡∏≤
- ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô JB√ó2

---

## 9. ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡∏™‡∏£‡∏∏‡∏õ)

| ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° | ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• |
|------------|---------|---------|--------|
| **MAX_BRANCHES** | 12 | **18** | ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡∏£‡∏≠‡∏õ |
| **TARGET_BRANCHES** | 9 | **12** | ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏∂‡πâ‡∏ô |
| **TARGET_UTIL** | 95% | **100%** | ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏∂‡πâ‡∏ô |
| **MAX_PICKUP_UTIL** | 125% | **130%** | ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô |
| **‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î** | 40km | **60km** | ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô |
| **‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á Phase 1.25** | 30km | **50km** | ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏î‡πâ‡πÑ‡∏Å‡∏•‡∏Ç‡∏∂‡πâ‡∏ô |
| **MAX_DETOUR** | 12km | 12km | ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° |
| **BUFFER** | 1.05 | 1.05 | ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° |

---

## 10. ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 1: ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û
```
Input: 15 ‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û, 8.5m¬≥, 3000kg
Phase 1: ‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏ó‡∏£‡∏¥‡∏õ
Phase 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ
  - cube_util_4w = 8.5/5.0 = 170% ‚ùå
  - cube_util_jb = 8.5/7.0 = 121% ‚ö†Ô∏è
  - recommended = 'JB' (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ JB, ‡∏´‡πâ‡∏≤‡∏° 6W)
Result: 1 ‡∏ó‡∏£‡∏¥‡∏õ, JB, 121% util
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 2: ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏Å‡∏• (‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà)
```
Input: 18 ‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà, 15m¬≥, 4500kg
Phase 1: ‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏ó‡∏£‡∏¥‡∏õ
Phase 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ
  - max_distance = 650km > 200km ‚Üí 6W mandatory
  - cube_util_6w = 15/20 = 75%
  - recommended = '6W'
Result: 1 ‡∏ó‡∏£‡∏¥‡∏õ, 6W, 75% util
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 3: ‡∏ó‡∏£‡∏¥‡∏õ‡∏ï‡πà‡∏≥
```
Input: Trip A (6 ‡∏™‡∏≤‡∏Ç‡∏≤, 30% util) + Trip B (8 ‡∏™‡∏≤‡∏Ç‡∏≤, 45% util)
Phase 1.75: Rebalance
  - Trip A util < 50% ‚úÖ
  - Trip B ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á (<50km) ‚úÖ
  - Combined: 14 ‡∏™‡∏≤‡∏Ç‡∏≤, 75% util ‚úÖ
  - Merge success!
Result: 1 ‡∏ó‡∏£‡∏¥‡∏õ, 14 ‡∏™‡∏≤‡∏Ç‡∏≤, 75% util
```

---

## 11. ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‚úÖ

‚úÖ **‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡∏£‡∏≠‡∏õ** ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏° MAX_BRANCHES ‡πÄ‡∏õ‡πá‡∏ô 18
‚úÖ **‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ï‡πá‡∏°** ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏° TARGET_UTIL ‡πÄ‡∏õ‡πá‡∏ô 100%
‚úÖ **‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î** ‚Üí ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô
‚úÖ **‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** ‚Üí ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏´‡πâ‡∏≤‡∏° 6W, ‡πÑ‡∏Å‡∏•‡πÉ‡∏ä‡πâ 6W
‚úÖ **‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á** ‚Üí ‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ‡∏ï‡πà‡∏≥, ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°

---

**‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** 2024
**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:** 2.2 - Full Queue Optimization
