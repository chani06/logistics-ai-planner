# тЬЕ р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕Вр╕Фр╕гр╕нр╕Ы (р╕Ир╕│р╕Щр╕зр╕Щр╕кр╕▓р╕Вр╕▓р╕Хр╣Ир╕нр╕Чр╕гр╕┤р╕Ы)

## р╕Бр╕Ор╕лр╕ер╕▒р╕Б:
- **р╕гр╕Цр╣Ар╕ер╣Зр╕Б (4W/JB)**: тЙд 12 р╕кр╕▓р╕Вр╕▓ (р╕Ър╕▒р╕Зр╕Др╕▒р╕Ъ)
- **р╕гр╕Цр╣Гр╕лр╕Нр╣И (6W)**: тЙд 18 р╕кр╕▓р╕Вр╕▓ (р╕нр╕Щр╕╕р╣Вр╕ер╕б)

## р╕Ир╕╕р╕Фр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕Щр╕гр╕░р╕Ър╕Ъ:

### 1. **Config Level** (р╕Ър╕гр╕гр╕Чр╕▒р╕Ф 38)
```python
MAX_BRANCHES_PER_TRIP = 18  # р╕Др╣Ир╕▓ default р╕кр╕│р╕лр╕гр╕▒р╕Ъ 6W
```

### 2. **Phase 1: р╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕Чр╕гр╕┤р╕Ыр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ** (р╕Ър╕гр╕гр╕Чр╕▒р╕Ф 1336)
```python
if len(current_trip) >= MAX_BRANCHES_PER_TRIP:
    continue  # р╣Ар╕Бр╕┤р╕Щ 18 р╕кр╕▓р╕Вр╕▓р╣Бр╕ер╣Йр╕з
```
тЬЕ **р╣Гр╕Кр╣Йр╕Др╣Ир╕▓ global** (18 р╕кр╕▓р╕Вр╕▓)

### 3. **Phase 2.1: р╕Бр╕▓р╕гр╣Бр╕вр╕Бр╕Чр╕гр╕┤р╕Ыр╕Хр╕▓р╕бр╕Вр╣Йр╕нр╕Ир╕│р╕Бр╕▒р╕Ф** (р╕Ър╕гр╕гр╕Чр╕▒р╕Ф 2624-2641)
```python
max_branches = 12 if target_vehicle in ['4W', 'JB'] else 18

if len(current_group) < max_branches:
    # р╣Гр╕кр╣Ир╣Др╕Фр╣Й
else:
    # р╕Хр╣Йр╕нр╕Зр╣Бр╕вр╕Бр╕Чр╕гр╕┤р╕Ы

should_create_new_trip = (
    current_util >= 95 or 
    (target_vehicle in ['4W', 'JB'] and current_branches >= 12)
)
```
тЬЕ **р╣Бр╕вр╕Б 4W/JB р╣Бр╕ер╕░ 6W р╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ**

### 4. **р╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╕гр╕Цр╣Ар╕бр╕╖р╣Ир╕нр╣Бр╕вр╕Бр╕Чр╕гр╕┤р╕Ы** (р╕Ър╕гр╕гр╕Чр╕▒р╕Ф 2705, 2712)
```python
# р╕ер╕нр╕З 4W (р╕Цр╣Йр╕▓ тЙд12 р╕кр╕▓р╕Вр╕▓)
if group_branches <= 12:
    if util_4w >= 90 and util_4w <= 130:
        best_vehicle = '4W'

# р╕ер╕нр╕З JB (р╕Цр╣Йр╕▓ тЙд12 р╕кр╕▓р╕Вр╕▓)
if group_branches <= 12:
    if util_jb >= 90 and util_jb <= 140:
        best_vehicle = 'JB'
```
тЬЕ **р╕Ър╕▒р╕Зр╕Др╕▒р╕Ър╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ир╕│р╕Щр╕зр╕Щр╕кр╕▓р╕Вр╕▓р╕Бр╣Ир╕нр╕Щр╣Ар╕ер╕╖р╕нр╕Бр╕гр╕Цр╣Ар╕ер╣Зр╕Б**

### 5. **р╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕е (Warning)** (р╕Ър╕гр╕гр╕Чр╕▒р╕Ф 3245-3250)
```python
if trip_branch_count > 12:
    if truck_type in ['4W', 'JB']:
        return "тЪая╕П р╣Ар╕Бр╕┤р╕Щ 12 р╕кр╕▓р╕Вр╕▓"
    else:  # 6W
        return "тЬЕ р╕вр╕нр╕бр╣Др╕Фр╣Й"
```
тЬЕ **р╣Бр╕вр╕Бр╣Ар╕Хр╕╖р╕нр╕Щр╕Хр╕▓р╕бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕гр╕Ц**

## тЬЕ р╕кр╕гр╕╕р╕Ы: р╣Др╕бр╣Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╕Чр╕▒р╕Ър╕Лр╣Йр╕нр╕Щ

### р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З:

1. **Phase 1**: р╕кр╕гр╣Йр╕▓р╕Зр╕Чр╕гр╕┤р╕Ыр╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕Хр╣Йр╕Щ (р╣Гр╕Кр╣Й 18 р╕кр╕▓р╕Вр╕▓ global)
2. **Phase 2**: р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕Цр╕Хр╕▓р╕бр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣И
3. **Phase 2.1**: 
   - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕гр╕Цр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕лр╕бр╕▓р╕░р╕кр╕бр╣Др╕лр╕б
   - р╕Цр╣Йр╕▓ 4W/JB р╣Ар╕Бр╕┤р╕Щ 12 тЖТ **р╕Ър╕▒р╕Зр╕Др╕▒р╕Ър╣Бр╕вр╕Б**
   - р╕Цр╣Йр╕▓ 6W р╣Ар╕Бр╕┤р╕Щ 18 тЖТ р╣Бр╕вр╕Б (р╣Бр╕Хр╣Ир╕нр╕Щр╕╕р╣Вр╕ер╕бр╣Др╕Фр╣Й)
4. **р╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╕гр╕Цр╕лр╕ер╕▒р╕Зр╣Бр╕вр╕Б**: 
   - р╕Цр╣Йр╕▓р╕Бр╕ер╕╕р╣Ир╕б тЙд12 р╕кр╕▓р╕Вр╕▓ тЖТ р╕ер╕нр╕З 4W/JB
   - р╕Цр╣Йр╕▓р╕Бр╕ер╕╕р╣Ир╕б >12 р╕кр╕▓р╕Вр╕▓ тЖТ р╣Гр╕Кр╣Й 6W р╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ
5. **UI**: р╣Бр╕кр╕Фр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Цр╣Йр╕▓ 4W/JB >12 р╕кр╕▓р╕Вр╕▓

## р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ:

### р╕Чр╕гр╕┤р╕Ыр╕Чр╕╡р╣Ир╕Ьр╣Ир╕▓р╕Щ тЬЕ
```
Trip 1: 4W - 10 р╕кр╕▓р╕Вр╕▓ (95% util) тЖТ тЬЕ OK
Trip 2: JB - 12 р╕кр╕▓р╕Вр╕▓ (98% util) тЖТ тЬЕ OK
Trip 3: 6W - 15 р╕кр╕▓р╕Вр╕▓ (100% util) тЖТ тЬЕ OK
```

### р╕Чр╕гр╕┤р╕Ыр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╣Бр╕вр╕Б тЬВя╕П
```
Trip X: 4W - 14 р╕кр╕▓р╕Вр╕▓ (110% util)
тЖТ р╣Бр╕вр╕Бр╣Ар╕Ыр╣Зр╕Щ:
  - Trip X1: 4W - 7 р╕кр╕▓р╕Вр╕▓ (98%)
  - Trip X2: 4W - 7 р╕кр╕▓р╕Вр╕▓ (92%)
```

### р╕Чр╕гр╕┤р╕Ыр╕Чр╕╡р╣Ир╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕гр╕Ц ЁЯЪЫ
```
Trip Y: 4W - 8 р╕кр╕▓р╕Вр╕▓ р╣Бр╕Хр╣Ир╣Ар╕Бр╕┤р╕Щ 12 р╕кр╕▓р╕Вр╕▓ (р╕Чр╕▒р╕Ър╕Лр╣Йр╕нр╕Щ)
тЖТ Phase 2.1 р╕Хр╕гр╕зр╕Ир╕Юр╕Ъ
тЖТ р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щ JB р╕лр╕гр╕╖р╕нр╣Бр╕вр╕Бр╕Чр╕гр╕┤р╕Ы
```

## ЁЯОп р╕Бр╕▓р╕гр╕▒р╕Щр╕Хр╕╡:
- тЬЕ р╕гр╕Цр╣Ар╕ер╣Зр╕Б (4W/JB) **р╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 12 р╕кр╕▓р╕Вр╕▓**
- тЬЕ р╕гр╕Цр╣Гр╕лр╕Нр╣И (6W) **р╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 18 р╕кр╕▓р╕Вр╕▓** (р╕нр╕Щр╕╕р╣Вр╕ер╕б)
- тЬЕ **р╣Др╕бр╣Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╕Чр╕▒р╕Ър╕Лр╣Йр╕нр╕Щ** р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З Phase р╕Хр╣Ир╕▓р╕Зр╣Ж
- тЬЕ р╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Лр╣Йр╕│р╕Лр╣Йр╕нр╕Щр╕лр╕ер╕▓р╕вр╕Ир╕╕р╕Ф (Fail-safe)
