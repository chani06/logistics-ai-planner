"""
‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Test ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á:
1. ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤
2. ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏à‡∏≤‡∏Å Master
3. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
4. ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ó‡∏£‡∏¥‡∏õ‡∏Ñ‡∏£‡∏ö
"""

import pandas as pd
import sys
import os

# ‡πÄ‡∏û‡∏¥‡πà‡∏° path ‡πÄ‡∏û‡∏∑‡πà‡∏≠ import ‡∏à‡∏≤‡∏Å app.py
sys.path.insert(0, os.path.dirname(__file__))

# ‡πÇ‡∏´‡∏•‡∏î Master Data
try:
    MASTER_DATA = pd.read_excel('Master.xlsx')
    print(f"‚úÖ ‡πÇ‡∏´‡∏•‡∏î Master Data ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: {len(MASTER_DATA)} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")
except Exception as e:
    print(f"‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Master Data: {e}")
    MASTER_DATA = pd.DataFrame()

# ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ 77 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÑ‡∏ó‡∏¢
THAI_PROVINCES = [
    '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û', '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£', '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£', '‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ', '‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ', '‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°', '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£',
    '‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤', '‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤', '‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á', '‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ', '‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ', '‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó', '‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ',
    '‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ', '‡∏£‡∏∞‡∏¢‡∏≠‡∏á', '‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ', '‡∏ï‡∏£‡∏≤‡∏î', '‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤', '‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ', '‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å', '‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß',
    '‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤', '‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä', '‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå', '‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå', '‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©', '‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ', '‡∏¢‡πÇ‡∏™‡∏ò‡∏£', '‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥',
    '‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç', '‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π', '‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô', '‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ', '‡πÄ‡∏•‡∏¢', '‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢', '‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°',
    '‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î', '‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå', '‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£', '‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°', '‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£', '‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨',
    '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà', '‡∏•‡∏≥‡∏û‡∏π‡∏ô', '‡∏•‡∏≥‡∏õ‡∏≤‡∏á', '‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå', '‡πÅ‡∏û‡∏£‡πà', '‡∏ô‡πà‡∏≤‡∏ô', '‡∏û‡∏∞‡πÄ‡∏¢‡∏≤', '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢', '‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô',
    '‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå', '‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ', '‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£', '‡∏ï‡∏≤‡∏Å', '‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢', '‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å', '‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£', '‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå',
    '‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ', '‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ', '‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ', '‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°', '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°', '‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ', '‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå',
    '‡∏ä‡∏∏‡∏°‡∏û‡∏£', '‡∏£‡∏∞‡∏ô‡∏≠‡∏á', '‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ', '‡∏û‡∏±‡∏á‡∏á‡∏≤', '‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà', '‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï', '‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä', '‡∏ï‡∏£‡∏±‡∏á',
    '‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á', '‡∏™‡∏á‡∏Ç‡∏•‡∏≤', '‡∏™‡∏ï‡∏π‡∏•', '‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ', '‡∏¢‡∏∞‡∏•‡∏≤', '‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™'
]

def extract_province_from_name(branch_name):
    """‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤"""
    if not branch_name:
        return None
    name = str(branch_name).strip()
    for province in THAI_PROVINCES:
        if province in name:
            return province
    return None

def test_province_extraction():
    """‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤"""
    print("\n" + "="*80)
    print("üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤")
    print("="*80)
    
    test_cases = [
        ("‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å5", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å"),
        ("‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤2", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤"),
        ("‡πÇ‡∏•‡∏ï‡∏±‡∏™ ‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ"),
        ("‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û 3", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û"),
        ("‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ ‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏£‡∏±‡∏•", "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ"),
    ]
    
    passed = 0
    failed = 0
    
    for name, expected in test_cases:
        result = extract_province_from_name(name)
        if result == expected:
            print(f"  ‚úÖ '{name}' ‚Üí '{result}'")
            passed += 1
        else:
            print(f"  ‚ùå '{name}' ‚Üí '{result}' (‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤ '{expected}')")
            failed += 1
    
    print(f"\nüìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: {passed} ‡∏ú‡πà‡∏≤‡∏ô, {failed} ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô")
    return passed, failed

def test_master_data_lookup():
    """‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Master Data"""
    print("\n" + "="*80)
    print("üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏à‡∏≤‡∏Å Master Data")
    print("="*80)
    
    if MASTER_DATA.empty:
        print("  ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ Master Data ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö")
        return 0, 0
    
    # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡πÉ‡∏ô Master
    test_codes = MASTER_DATA['Plan Code'].head(5).tolist() if 'Plan Code' in MASTER_DATA.columns else []
    
    passed = 0
    failed = 0
    
    for code in test_codes:
        master_row = MASTER_DATA[MASTER_DATA['Plan Code'] == code]
        if len(master_row) > 0:
            row = master_row.iloc[0]
            province = row.get('‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '')
            district = row.get('‡∏≠‡∏≥‡πÄ‡∏†‡∏≠', '')
            subdistrict = row.get('‡∏ï‡∏≥‡∏ö‡∏•', '')
            
            if province and district and subdistrict:
                print(f"  ‚úÖ {code}: {province} > {district} > {subdistrict}")
                passed += 1
            else:
                print(f"  ‚ö†Ô∏è {code}: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö (‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î={province}, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠={district}, ‡∏ï‡∏≥‡∏ö‡∏•={subdistrict})")
                failed += 1
    
    print(f"\nüìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: {passed} ‡∏™‡∏≤‡∏Ç‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö, {failed} ‡∏™‡∏≤‡∏Ç‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö")
    return passed, failed

def test_backoffice_file():
    """‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå Test ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô"""
    print("\n" + "="*80)
    print("üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå Test ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô")
    print("="*80)
    
    # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå Test ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
    test_files = []
    for file in os.listdir('.'):
        if file.endswith('.xlsx') or file.endswith('.xls'):
            if 'test' in file.lower() or 'backoffice' in file.lower() or '‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô' in file.lower():
                test_files.append(file)
    
    if not test_files:
        print("  ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå Test ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô")
        print("  üí° ‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Test ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ô‡∏µ‡πâ")
        return 0, 0
    
    print(f"  üìÅ ‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå: {', '.join(test_files)}")
    
    passed = 0
    failed = 0
    
    for test_file in test_files:
        print(f"\n  üìÑ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå: {test_file}")
        try:
            df = pd.read_excel(test_file)
            print(f"    ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: {len(df)} ‡πÅ‡∏ñ‡∏ß")
            
            # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
            required_cols = ['Code', 'Name', 'Weight', 'Cube']
            missing_cols = [col for col in required_cols if col not in df.columns]
            
            if missing_cols:
                print(f"    ‚ö†Ô∏è ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢: {', '.join(missing_cols)}")
                failed += 1
                continue
            
            # ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤
            print(f"\n    üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤:")
            df['ExtractedProvince'] = df['Name'].apply(extract_province_from_name)
            
            branches_with_province = df[df['ExtractedProvince'].notna()]
            print(f"      ‚úÖ ‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ: {len(branches_with_province)}/{len(df)} ‡∏™‡∏≤‡∏Ç‡∏≤ ({len(branches_with_province)/len(df)*100:.1f}%)")
            
            # ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
            print(f"\n    üìã ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å):")
            for idx, row in df.head(10).iterrows():
                code = row['Code']
                name = row['Name']
                prov = row['ExtractedProvince']
                
                # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏±‡∏ö Master ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                master_prov = ''
                if not MASTER_DATA.empty and 'Plan Code' in MASTER_DATA.columns:
                    master_row = MASTER_DATA[MASTER_DATA['Plan Code'] == code]
                    if len(master_row) > 0:
                        master_prov = master_row.iloc[0].get('‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '')
                
                if prov:
                    if master_prov and prov != master_prov:
                        print(f"      ‚ö†Ô∏è {code} '{name}' ‚Üí {prov} (Master={master_prov})")
                    else:
                        print(f"      ‚úÖ {code} '{name}' ‚Üí {prov}")
                else:
                    print(f"      ‚ùå {code} '{name}' ‚Üí ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î")
            
            # ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏à‡∏≤‡∏Å Master
            if not MASTER_DATA.empty:
                print(f"\n    üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏à‡∏≤‡∏Å Master:")
                codes_in_master = 0
                codes_with_full_data = 0
                
                for code in df['Code'].head(20):
                    if 'Plan Code' in MASTER_DATA.columns:
                        master_row = MASTER_DATA[MASTER_DATA['Plan Code'] == code]
                        if len(master_row) > 0:
                            codes_in_master += 1
                            row = master_row.iloc[0]
                            if row.get('‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î') and row.get('‡∏≠‡∏≥‡πÄ‡∏†‡∏≠') and row.get('‡∏ï‡∏≥‡∏ö‡∏•'):
                                codes_with_full_data += 1
                
                print(f"      ‚úÖ ‡∏°‡∏µ‡πÉ‡∏ô Master: {codes_in_master}/20 ‡∏™‡∏≤‡∏Ç‡∏≤")
                print(f"      ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö (‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î+‡∏≠‡∏≥‡πÄ‡∏†‡∏≠+‡∏ï‡∏≥‡∏ö‡∏•): {codes_with_full_data}/20 ‡∏™‡∏≤‡∏Ç‡∏≤")
            
            passed += 1
            
        except Exception as e:
            print(f"    ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {e}")
            failed += 1
    
    print(f"\nüìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå: {passed} ‡∏ú‡πà‡∏≤‡∏ô, {failed} ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô")
    return passed, failed

def main():
    """‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"""
    print("\n" + "="*80)
    print("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô")
    print("="*80)
    
    total_passed = 0
    total_failed = 0
    
    # Test 1: Province Extraction
    p, f = test_province_extraction()
    total_passed += p
    total_failed += f
    
    # Test 2: Master Data Lookup
    p, f = test_master_data_lookup()
    total_passed += p
    total_failed += f
    
    # Test 3: Backoffice File
    p, f = test_backoffice_file()
    total_passed += p
    total_failed += f
    
    # ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
    print("\n" + "="*80)
    print("üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")
    print("="*80)
    print(f"  ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: {total_passed} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")
    print(f"  ‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: {total_failed} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")
    
    if total_failed == 0:
        print(f"\n  üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")
    else:
        print(f"\n  ‚ö†Ô∏è ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î {total_failed} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö")
    
    print("="*80)

if __name__ == "__main__":
    main()
