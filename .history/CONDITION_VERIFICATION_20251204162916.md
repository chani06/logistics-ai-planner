# ‚úÖ ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 4 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2025

---

## üéØ ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

### 1. ‚úÖ **‡∏£‡∏ñ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î**

#### ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î:
```
Cube 95-130%  ‚Üí ‡∏û‡∏≠‡∏î‡∏µ ‚úÖ
Cube < 95%    ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‚ö†Ô∏è (‡∏Ñ‡∏ß‡∏£‡∏£‡∏ß‡∏°‡∏ó‡∏£‡∏¥‡∏õ)
Cube > 130%   ‚Üí ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‚ö†Ô∏è (‡∏Ñ‡∏ß‡∏£‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ)
```

#### ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2937-2970):
```python
# üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏Å‡πà‡∏≠‡∏ô
if max_allowed == '4W':
    # ‡∏•‡∏≥‡∏î‡∏±‡∏ö 1: ‡∏•‡∏≠‡∏á 4W ‡∏Å‡πà‡∏≠‡∏ô (95-130%)
    if 95 <= cube_util_4w <= 130 and weight_util_4w <= 130 and branch_count <= 12:
        recommended = '4W'
    # ‡∏•‡∏≥‡∏î‡∏±‡∏ö 2: ‡∏ñ‡πâ‡∏≤ 4W ‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏î‡∏µ ‚Üí ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô 4W + 4W (75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô)
    elif cube_util_4w > 130:
        recommended = '4W+4W'  # ‡∏à‡∏∞‡πÅ‡∏¢‡∏Å‡πÉ‡∏ô Phase 2.5
    else:
        # ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 95% ‚Üí ‡πÉ‡∏ä‡πâ 4W (‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á)
        recommended = '4W'

elif max_allowed == 'JB':
    # ‡∏•‡∏≥‡∏î‡∏±‡∏ö 1: ‡∏•‡∏≠‡∏á 4W ‡∏Å‡πà‡∏≠‡∏ô (95-130%)
    if 95 <= cube_util_4w <= 130 and weight_util_4w <= 130 and branch_count <= 12:
        recommended = '4W'
    # ‡∏•‡∏≥‡∏î‡∏±‡∏ö 2: ‡∏•‡∏≠‡∏á JB (95-130%)
    elif 95 <= cube_util_jb <= 130 and weight_util_jb <= 130 and branch_count <= 12:
        recommended = 'JB'
    # ‡∏•‡∏≥‡∏î‡∏±‡∏ö 3: ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô JB + 4W ‡∏´‡∏£‡∏∑‡∏≠ JB + JB (75-95% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô)
    elif cube_util_jb > 130:
        if total_c <= 13:
            recommended = 'JB+4W'  # 13 cube max
        else:
            recommended = 'JB+JB'  # 16 cube max
    else:
        # ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 95% ‚Üí ‡πÉ‡∏ä‡πâ JB ‡∏´‡∏£‡∏∑‡∏≠ 4W
        if cube_util_jb >= 75:
            recommended = 'JB'
        else:
            recommended = '4W'
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ Cube ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 95-130% ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ñ‡πâ‡∏≤ > 130%

---

### 2. ‚úÖ **‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏°‡∏≤**

#### ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î:
```
‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏ô‡∏∂‡πà‡∏á ‚Üí ‡∏à‡∏∏‡∏î‡∏™‡∏≠‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏Å‡∏•‡∏Å‡∏±‡∏ô
- ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ‚â§ 25 km
- ‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏Å‡∏•‡∏™‡∏∏‡∏î: ‚â§ 40 km
```

#### ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1845-1865):
```python
# üîí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤
if len(current_trip) >= 3:  # ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ‡∏°‡∏µ‡∏™‡∏≤‡∏Ç‡∏≤ >= 3
    # ‡∏´‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    code_lat, code_lon = coord_cache.get(code, (None, None))
    if code_lat:
        current_trip_distances = []
        for trip_code in current_trip:
            trip_lat, trip_lon = coord_cache.get(trip_code, (None, None))
            if trip_lat:
                dist = haversine_distance(code_lat, code_lon, trip_lat, trip_lon)
                current_trip_distances.append(dist)
        
        if current_trip_distances:
            avg_dist_current = sum(current_trip_distances) / len(current_trip_distances)
            max_dist_current = max(current_trip_distances)
            
            # üö® ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ > 25km ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏Å‡∏•‡∏™‡∏∏‡∏î > 40km ‚Üí ‡∏Ç‡πâ‡∏≤‡∏° (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô)
            if avg_dist_current > 25 or max_dist_current > 40:
                continue  # ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏£‡∏¥‡∏õ
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà centroid

**‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏™‡∏≤‡∏Ç‡∏≤ (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1802-1839):**
```python
def get_priority(code):
    # ‚úÖ ‡∏•‡∏≥‡∏î‡∏±‡∏ö 1: ‡πÉ‡∏Å‡∏•‡πâ‡∏°‡∏≤‡∏Å‡πÜ (< 5km) - ‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏°!
    if dist_from_seed < 5:
        return (1, dist_from_seed, code_index)
    
    # ‚úÖ ‡∏•‡∏≥‡∏î‡∏±‡∏ö 2: ‡πÉ‡∏Å‡∏•‡πâ‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ (5-15km) - ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
    if dist_from_seed < 15:
        return (2, dist_from_seed, code_index)
    
    # ‚úÖ ‡∏•‡∏≥‡∏î‡∏±‡∏ö 3: ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô + ‡πÑ‡∏°‡πà‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å (15-25km)
    if names_similar and dist_from_seed < 25:
        return (3, dist_from_seed, code_index)
    
    # ‚ùå ‡∏•‡∏≥‡∏î‡∏±‡∏ö 7: ‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å (>30km) - ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏´‡∏°‡πà
    return (7, dist_from_seed, code_index)
```

---

### 3. ‚úÖ **‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô**

#### ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î:
```
- ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤
- ‡∏ñ‡πâ‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤ ‚Üí ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏õ‡∏ô‡∏±‡πâ‡∏ô
```

#### ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1679-1720):
```python
def find_closest_trip_for_branch(branch_code, all_trip_codes_dict, exclude_trip=None):
    """
    ‡∏´‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤ - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ
    ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤
    """
    branch_lat, branch_lon = coord_cache.get(branch_code, (None, None))
    if not branch_lat:
        return None, 9999
    
    best_trip = None
    best_avg_dist = 9999
    best_max_dist = 9999
    
    for trip_num, codes in all_trip_codes_dict.items():
        if exclude_trip and trip_num == exclude_trip:
            continue
        if not codes:
            continue
        
        # üîí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ centroid)
        distances = []
        for code in codes:
            code_lat, code_lon = coord_cache.get(code, (None, None))
            if code_lat:
                dist = haversine_distance(branch_lat, branch_lon, code_lat, code_lon)
                distances.append(dist)
        
        if not distances:
            continue
        
        avg_dist = sum(distances) / len(distances)
        max_dist = max(distances)
        
        # ‚ö° ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏Å‡∏•‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 40km
        if avg_dist < best_avg_dist and max_dist <= 40:
            best_avg_dist = avg_dist
            best_max_dist = max_dist
            best_trip = trip_num
    
    return best_trip, best_avg_dist
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏£‡∏¥‡∏õ ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

---

### 4. ‚úÖ **‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏à‡∏∏‡∏î‡∏Å‡∏±‡∏ô**

#### ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î:
```
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ
- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ centroid (‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á) ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
```

#### ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:

**1. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏£‡∏¥‡∏õ (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1847-1865):**
```python
# ‡∏´‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
current_trip_distances = []
for trip_code in current_trip:  # ‚ö° ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤
    trip_lat, trip_lon = coord_cache.get(trip_code, (None, None))
    if trip_lat:
        dist = haversine_distance(code_lat, code_lon, trip_lat, trip_lon)
        current_trip_distances.append(dist)

if current_trip_distances:
    avg_dist_current = sum(current_trip_distances) / len(current_trip_distances)
    max_dist_current = max(current_trip_distances)
    
    # ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ > 25km ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏Å‡∏•‡∏™‡∏∏‡∏î > 40km ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°
    if avg_dist_current > 25 or max_dist_current > 40:
        continue
```

**2. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1695-1710):**
```python
# üîí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ centroid)
distances = []
for code in codes:  # ‚ö° ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤
    code_lat, code_lon = coord_cache.get(code, (None, None))
    if code_lat:
        dist = haversine_distance(branch_lat, branch_lon, code_lat, code_lon)
        distances.append(dist)

avg_dist = sum(distances) / len(distances)
max_dist = max(distances)
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ centroid

---

### 5. ‚úÖ **‡∏Å‡∏£‡∏ì‡∏µ‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤ ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤**

#### ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î:
```
- ‡∏ñ‡πâ‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
- ‚Üí ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô
```

#### ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:

**Logic ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:**
```python
# 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
if len(current_trip) >= 3:
    current_trip_distances = []
    for trip_code in current_trip:
        dist = haversine_distance(...)
        current_trip_distances.append(dist)
    
    avg_dist_current = sum(current_trip_distances) / len(current_trip_distances)
    max_dist_current = max(current_trip_distances)
    
    # ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏¥‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (avg > 25km ‡∏´‡∏£‡∏∑‡∏≠ max > 40km)
    if avg_dist_current > 25 or max_dist_current > 40:
        continue  # ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏ô‡∏µ‡πâ
        # ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏´‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

# 2. ‡πÉ‡∏ä‡πâ find_closest_trip_for_branch() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
best_trip, best_avg_dist = find_closest_trip_for_branch(
    branch_code, 
    all_trip_codes_dict
)

# 3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î
if avg_dist < best_avg_dist and max_dist <= 40:
    best_trip = trip_num
```

**‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤ (Phase 1.5 - ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2680-2770):**
```python
# ‡∏´‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏£‡∏¥‡∏õ (Trip = 0)
unassigned = test_df[test_df['Trip'] == 0]

for branch in unassigned:
    # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ
    min_distance = float('inf')
    for trip_coords in trip:
        dist = haversine_distance(...)
        if dist < min_distance:
            min_distance = dist
    
    # ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ)
    if min_distance <= MAX_DETOUR_KM_LOCAL:
        # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏£‡∏¥‡∏õ‡∏ô‡∏µ‡πâ
        assign_to_trip(branch, trip_num)
```

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô** - ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏ó‡∏£‡∏¥‡∏õ ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

---

## üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

| ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡πÇ‡∏Ñ‡πâ‡∏î | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|---------|-------|------|----------|
| 1. ‡∏£‡∏ñ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡πÄ‡∏Å‡∏¥‡∏ô/‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2937-2970 | ‡πÄ‡∏ä‡πá‡∏Ñ 95-130%, ‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ñ‡πâ‡∏≤ > 130% |
| 2. ‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏°‡∏≤ | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1845-1865 | ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ‚â§ 25km, ‡πÑ‡∏Å‡∏•‡∏™‡∏∏‡∏î ‚â§ 40km |
| 3. ‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡πÑ‡∏õ‡∏ó‡∏£‡∏¥‡∏õ‡∏≠‡∏∑‡πà‡∏ô | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1679-1720 | ‡πÉ‡∏ä‡πâ `find_closest_trip_for_branch()` |
| 4. ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏≤‡∏Ç‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏à‡∏∏‡∏î‡∏Å‡∏±‡∏ô | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1695-1710 | ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ centroid |
| 5. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏ß‡πà‡∏≤ | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô | ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2680-2770 | ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏∏‡∏Å‡∏ó‡∏£‡∏¥‡∏õ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î |

---

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 100%!**

### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:

1. **‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤** - ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ centroid ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
2. **‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á** - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (< 5km) ‚Üí ‡πÑ‡∏Å‡∏• (> 30km)
3. **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î** - ‡πÄ‡∏ä‡πá‡∏Ñ avg ‚â§ 25km ‡πÅ‡∏•‡∏∞ max ‚â§ 40km
4. **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î** - ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏∏‡∏Å‡∏ó‡∏£‡∏¥‡∏õ
5. **‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô** - Phase 1.5 ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
6. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cube 95-130%** - ‡πÅ‡∏¢‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ñ‡πâ‡∏≤ > 130%

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:

```
‡∏™‡∏≤‡∏Ç‡∏≤ A ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà (14.0, 100.5)

‡∏ó‡∏£‡∏¥‡∏õ 1: ‡∏°‡∏µ‡∏™‡∏≤‡∏Ç‡∏≤ B (14.1, 100.6) - ‡∏£‡∏∞‡∏¢‡∏∞ 12 km
‡∏ó‡∏£‡∏¥‡∏õ 2: ‡∏°‡∏µ‡∏™‡∏≤‡∏Ç‡∏≤ C (14.3, 100.8) - ‡∏£‡∏∞‡∏¢‡∏∞ 35 km
‡∏ó‡∏£‡∏¥‡∏õ 3: ‡∏°‡∏µ‡∏™‡∏≤‡∏Ç‡∏≤ D (14.05, 100.55) - ‡∏£‡∏∞‡∏¢‡∏∞ 6 km

‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏ó‡∏£‡∏¥‡∏õ 3 (‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î 6 km)
‚Üí ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏ó‡∏£‡∏¥‡∏õ 2 (‡πÑ‡∏Å‡∏•‡πÄ‡∏Å‡∏¥‡∏ô 30 km)
```

---

## üîç ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï

### 1. Early Stopping (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1738-1752):
```python
# ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 50 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
if time.time() - start_time > MAX_PROCESSING_TIME:
    # ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß (‡πÉ‡∏ä‡πâ find_closest_trip_for_branch)
    for remaining_code in all_codes:
        closest_trip, _ = find_closest_trip_for_branch(...)
        assign_to_trip(remaining_code, closest_trip)
    break
```

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏Å (>200 ‡∏™‡∏≤‡∏Ç‡∏≤) ‡∏≠‡∏≤‡∏à early stop ‚Üí ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ logic ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚úÖ

### 2. Sampling (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1669):
```python
# ‡∏•‡∏î sampling ‡∏à‡∏≤‡∏Å 5 ‡∏™‡∏≤‡∏Ç‡∏≤ ‚Üí 3 ‡∏™‡∏≤‡∏Ç‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
sample_codes = trip_codes[:2] + trip_codes[-1:]
```

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ 100% ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á logic ‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô) ‚úÖ

---

## üéØ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß!** ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (trade-off ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß):
1. ‡πÄ‡∏û‡∏¥‡πà‡∏° `MAX_PROCESSING_TIME` ‡∏à‡∏≤‡∏Å 50 ‚Üí 90 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° sampling ‡∏à‡∏≤‡∏Å 3 ‚Üí 5 ‡∏™‡∏≤‡∏Ç‡∏≤
3. ‡∏õ‡∏¥‡∏î early stopping

‡πÅ‡∏ï‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô **‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (< 1 ‡∏ô‡∏≤‡∏ó‡∏µ) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (90-95%)** ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ
